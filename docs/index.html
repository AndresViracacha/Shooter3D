<!DOCTYPE html>
<html lang="en">

<head>
    <title>El Pepe</title>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script> -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r122/three.js"
        integrity="sha512-iaZ8D6RzguOWQ+B5SLJCHPid3/2UaVIFnsNJHy068pv3r5G6kYOe+XufLqd6qNrQmaHeYR0iVyu2xkXB2llnMg=="
        crossorigin="anonymous"></script>
    <link rel="stylesheet" href="styles.css">
    <script src="js/librerias/stats.min.js"></script>
    <script src="js/librerias/inflate.min.js"></script>
    <script src="js/librerias/FBXLoader.js"></script>
    <script src="js/librerias/StereoEffect.js"></script>
    <script src="js/librerias/DeviceOrientationControls.js"></script>
    <script src="js/Clases/enemigo.js"></script>
    <script src="js/Clases/audio.js"></script>
    <script src="js/Clases/stats.js"></script>
    <script src="js/Clases/luces.js"></script>
    <script src="js/Clases/pistola.js"></script>
    <script src="js/Clases/Arboles.js"></script>
</head>

<body>
    < <div id="ThreeJS" style="position: absolute; left:0px; top:0px">
        </div>
        <script>
            //arreglos para los arboles
            var arbolesd = [];
            var arbolesi = [];

            var clock = new THREE.Clock();
            var enemigoNumero = 0;
            //VARIABLES RAYCAST
            var raycaster = new THREE.Raycaster();
            var mouse = new THREE.Vector2();
            //Escena
            var scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000010);


            //Camara
            var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);

            //Contenedores
            var contenedorPistola = new THREE.Object3D();
            var contenedorCamara = new THREE.Object3D();
            scene.add(contenedorCamara);

            //Render
            var renderer = new THREE.WebGLRenderer();
            renderer.setSize(window.innerWidth, window.innerHeight);
            container = document.getElementById('ThreeJS');
            container.appendChild(renderer.domElement);

            //mouse para RAYCAST
            function onMouseMove(event) {
                mouse.x = (event.clientX / window.innerWidth) * 2 - 1;
                mouse.y = - (event.clientY / window.innerHeight) * 2 + 1;
            }
            window.addEventListener('mousemove', onMouseMove, false);

            //luces
            var luz = new Luz();

            //cubo
            var geometry = new THREE.BoxGeometry();
            var material = new THREE.MeshBasicMaterial({ color: 0x00ff00 });
            var cube = new THREE.Mesh(geometry, material);
            scene.add(cube);

            //stereo
            effect = new THREE.StereoEffect(renderer);
            effect.setSize(window.innerWidth, window.innerHeight);

            //FBX-------------------------------------------------------
            var pistola = new Pistola();

            //stats
            Estadisticas();

            //el pepe
            let enemigos = [];
            var i = 0;
            function crearEnemigos(contenedorCamara, numero) {
                if (i == 200) {
                    enemigos.push(new Enemigo)
                    i = 0;
                }
                if (enemigos.length > 0) {
                    for (let i = 0; i < enemigos.length; i++) {
                        enemigos[i].crear(contenedorCamara)
                        enemigos[i].cube.position.x = 5
                    }
                }
                i++;
            }
            
            
            crearArboles();

            var a;
            //METODO MATAR
            window.addEventListener('pointerdown', function () {
                a = 0;
            }, false);
            window.addEventListener('pointerup', function () {
                a = 1;
            }, false);

            //DeviceOrientation
            var controls = new THREE.DeviceOrientationControls(contenedorCamara);

            //AUDIO 
            var audio = new Audio();

            //animateeeeeeeeeeeeeeeeeee
            var animate = function () {
                //arboles
                //console.log(a)
                crearEnemigos(contenedorCamara);
                raycaster.setFromCamera(mouse, contenedorCamara.children[0]);
                stats.update();
                controls.update();
                requestAnimationFrame(animate);
                var intersects = raycaster.intersectObjects(scene.children);
                if (intersects[0] && a == 0) {
                    contenedorPistola.children[0].position.y = 5
                    if (intersects[0].object.name == "sans") {
                        scene.remove(intersects[0].object)
                    }
                }
                //renderer.render( scene, camera );
                effect.render(scene, camera);
            };
            animate();
        </script>
        <div class="iz"></div>
        <div class="de"></div>
</body>

</html>